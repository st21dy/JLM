<div class="mx-sm-2 mx-md-3 mx-lg-5 mb-3 pt-5 pb-5">
  <section>
    
    <header class="text-center mb-3">
      <% if @article.user == current_user %>
      <ul class="nav justify-content-center">
        <li class="nav-item shadow border m-1">
          <%= link_to "編集", edit_article_path(@article), class: "nav-link text-dark" %>
        </li>
        <li class="nav-item shadow border m-1">
          <%= link_to "削除",article_path(@article), class: "nav-link text-dark", method: :delete %>
        </li>
      </ul>
      <% end %>
    </header>
    
    <div>
      <article class="d-flex flex-wrap justify-content-center">
        <section class="m-1">
          <header class="m-1">
            <%= attachment_image_tag @user, :icon, :fill, 30, 30, format: 'jpeg', fallback: "no_image.jpg", size:'30x30', class: "border border-dark rounded-circle" %>
            <%= link_to @user.name, user_path(@user.id), class: "line" %>
            <!--投稿者の詳細ページへのリンク-->
          </header>
          
          <!-- 動画と画像で表示を分ける-->
          <% if @article.video? %>
            <% type = file_type(@article.video.url)%> <!-- app/helpers/application_helper.rbにfile_typeを定義 -->
              <% if type == 'image' %>
                <%= image_tag @article.video.url, :size => "300x300" %>
              <% elsif type == 'video' %>
                <%= video_tag @article.video.url, autoplay: true, muted: true, controls: true, :size => "300x300" %>
              <% end %>
          <% end %>
          
          <small class="d-flex flex-nowrap">
            <%= @article.created_at.strftime('%Y/%m/%d') %>
          </small>
          
          <h4 class="text-center">
            <%= @article.title %>
          </h4>
          
          <h6 class="text-center">
            <%= @article.body %>
          </h6>
          
          <h6 class="text-center">
            <%= render_with_hashtags(@article.caption) %>
          </h6>
          
          <!-- いいね機能 -->
          <% if @article.liked_by?(current_user) %>
            <p class="text-center">
              <%= link_to article_likes_path(@article), class: "text-dark", method: :delete do %>
                ❤️ いいね! <%= @article.likes.count %>
              <% end %>
            </p>
          <% else %>
            <p class="text-center">
              <%= link_to article_likes_path(@article), class: "text-dark", method: :post do %>
                ❤️ いいね! <%= @article.likes.count %>
              <% end %>
            </p>
          <% end %>
          
          <div class="text-center m-2">
            <% @article.article_comments.each do |article_comment| %>
              <div class="border-bottom m-1">
                <strong><%= article_comment.user.name %></strong>
              
                <%= article_comment.comment %>
    
                <% if article_comment.user == current_user %>
                  <%= link_to "削除", article_article_comments_path(article_comment.article, article_comment), class: "text-danger", method: :delete %>
                <% end %>
              </div>
            <% end %>

            <%= form_with(model:[@article, @article_comment], local: true) do |f| %>
              <%= f.text_area :comment, rows:'5',placeholder: "コメントをここに" %>
              <%= f.submit "送信する" %>
            <% end %>
          </div>
        </section>
      </article>
    </div>
    
  </section>
</div>

